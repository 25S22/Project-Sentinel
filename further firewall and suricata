Of course. Here is a consolidated list of all the commands for setting up and demonstrating your firewall and IDS. You can run these one by one to achieve the final result.

## 1. Defender VM: Configure Firewall (iptables)
Run these commands on your Kali Purple (Defender) VM. It's best to save this as a script (configure-firewall.sh), make it executable (chmod +x), and then run it.

Bash

# --- 1. CLEAN SLATE: Flush all existing rules and chains ---
echo "Flushing all existing iptables rules..."
iptables -F
iptables -X
iptables -Z
iptables -t nat -F
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X

# --- 2. BASELINE SECURITY: Set default policies to DROP ---
echo "Setting default policies to DROP..."
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# --- 3. CORE RULES: Allow essential traffic ---
echo "Adding essential firewall rules..."
# Allow loopback traffic (system talking to itself)
iptables -A INPUT -i lo -j ACCEPT

# Allow traffic that is part of an established connection
iptables -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT

# Allow ping requests for troubleshooting
iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT

# --- 4. EXCEPTION RULES: Allow specific services for your project ---
echo "Allowing SSH and HTTP traffic..."
# Allow SSH on TCP port 22
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# Allow HTTP on TCP port 80 (for the attack simulation)
iptables -A INPUT -p tcp --dport 80 -j ACCEPT

# --- 5. PERSISTENCE: Install tool to save rules and save them ---
echo "Installing persistence package and saving rules..."
apt-get update
# The '-y' flag answers "yes" to the installation prompts
apt-get install iptables-persistent -y
netfilter-persistent save

# --- 6. VERIFICATION: Display the final ruleset ---
echo "Firewall configuration complete. Displaying rules:"
iptables -L -v -n
## 2. Defender VM: Configure IDS (Suricata)
Run these commands on your Kali Purple (Defender) VM after setting up the firewall.

Bash

# Install Suricata and update its ruleset
sudo apt-get install suricata -y
sudo suricata-update

# Run Suricata in the background, listening on your internal network (eth1)
sudo suricata -c /etc/suricata/suricata.yaml -i eth1 -D
## 3. Defender VM: Set Up Live Monitoring Dashboard
On your Kali Purple (Defender) VM, open two terminals and arrange them side-by-side to create your live dashboard.

In Terminal 1 (Live Firewall Counters):

Bash

watch -n 1 sudo iptables -L -v -n
In Terminal 2 (Live IDS Alerts):

Bash

sudo tail -f /var/log/suricata/fast.log
## 4. Attacker VM: Run Attack Simulations
Run these commands from your Attacker VM's terminal to test your defenses.

Test the Firewall's Port Blocking:

Bash

# Replace 192.168.10.3 with your Defender VM's IP if different
nmap -p 1-100 192.168.10.3
Test the IDS's Threat Detection:

Bash

# Replace 192.168.10.3 with your Defender VM's IP if different
curl -A "() { :;}; /bin/bash" http://192.168.10.3
