#!/bin/bash

# This script now uses 'host <website> 8.8.8.8' to force DNS resolution
# over the internet-connected interface (eth0).

if [[ "$1" == "--remove" ]]; then
    echo "Enter the website URL to UNBLOCK:"
    read -p "> " website
    # Use 8.8.8.8 to ensure DNS resolution works
    ip=$(host $website 8.8.8.8 | awk '/has address/ { print $4 }' | head -n 1)
    if [ -z "$ip" ]; then
        echo "Could not resolve IP for $website. Please check the URL."
        exit 1
    fi
    echo "Removing DROP rule for $website ($ip)..."
    iptables -D OUTPUT -d $ip -j DROP
    echo "Rule removed."
    exit 0
fi

echo "Enter the website URL to BLOCK:"
read -p "> " website
# Use 8.8.8.8 to ensure DNS resolution works
ip=$(host $website 8.8.8.8 | awk '/has address/ { print $4 }' | head -n 1)
if [ -z "$ip" ]; then
    echo "Could not resolve IP for $website. Please check the URL."
    exit 1
fi

echo "--- Pinging $website ($ip) BEFORE blocking... ---"
ping -c 2 $ip

echo "--- Adding DROP rule for $website ($ip)... ---"
iptables -A OUTPUT -d $ip -j DROP

echo "--- Pinging $website ($ip) AFTER blocking... ---"
ping -c 2 $ip

echo "Rule for $website has been added."
